{
  "questionId": "4227",
  "questionFrontendId": "3832",
  "title": "Find Users with Persistent Behavior Patterns",
  "titleSlug": "find-users-with-persistent-behavior-patterns",
  "content": "<p>Table: <code>activity</code></p>\n\n<pre>\n+--------------+---------+\n| Column Name  | Type    |\n+--------------+---------+\n| user_id      | int     |\n| action_date  | date    |\n| action       | varchar |\n+--------------+---------+\n(user_id, action_date, action) is the primary key (unique value) for this table.\nEach row represents a user performing a specific action on a given date.\n</pre>\n\n<p>Write a solution to identify <strong>behaviorally stable users</strong> based on the following definition:</p>\n\n<ul>\n\t<li>A user is considered <strong>behaviorally stable</strong> if there exists a sequence of <strong>at least </strong><code>5</code><strong> consecutive days</strong> such that:\n\n\t<ul>\n\t\t<li>The user performed <strong>exactly one action per day</strong> during that period.</li>\n\t\t<li>The <strong>action is the same</strong> on all those consecutive days.</li>\n\t</ul>\n\t</li>\n\t<li>If a user has multiple qualifying sequences, only consider the sequence with the <strong>maximum length</strong>.</li>\n</ul>\n\n<p>Return <em>the result table ordered by</em> <code>streak_length</code> <em>in <strong>descending</strong> order</em>,<em> then by </em><code>user_id</code> <em>in <strong>ascending</strong> order</em>.</p>\n\n<p>The result format is in the following example.</p>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example:</strong></p>\n\n<div class=\"example-block\">\n<p><strong>Input:</strong></p>\n\n<p>activity table:</p>\n\n<pre class=\"example-io\">\n+---------+-------------+--------+\n| user_id | action_date | action |\n+---------+-------------+--------+\n| 1       | 2024-01-01  | login  |\n| 1       | 2024-01-02  | login  |\n| 1       | 2024-01-03  | login  |\n| 1       | 2024-01-04  | login  |\n| 1       | 2024-01-05  | login  |\n| 1       | 2024-01-06  | logout |\n| 2       | 2024-01-01  | click  |\n| 2       | 2024-01-02  | click  |\n| 2       | 2024-01-03  | click  |\n| 2       | 2024-01-04  | click  |\n| 3       | 2024-01-01  | view   |\n| 3       | 2024-01-02  | view   |\n| 3       | 2024-01-03  | view   |\n| 3       | 2024-01-04  | view   |\n| 3       | 2024-01-05  | view   |\n| 3       | 2024-01-06  | view   |\n| 3       | 2024-01-07  | view   |\n+---------+-------------+--------+\n</pre>\n\n<p><strong>Output:</strong></p>\n\n<pre class=\"example-io\">\n+---------+--------+---------------+------------+------------+\n| user_id | action | streak_length | start_date | end_date   |\n+---------+--------+---------------+------------+------------+\n| 3       | view   | 7             | 2024-01-01 | 2024-01-07 |\n| 1       | login  | 5             | 2024-01-01 | 2024-01-05 |\n+---------+--------+---------------+------------+------------+\n</pre>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li><strong>User 1</strong>:\n\n\t<ul>\n\t\t<li>Performed <code>login</code> from 2024-01-01 to 2024-01-05 on consecutive days</li>\n\t\t<li>Each day has exactly one action, and the action is the same</li>\n\t\t<li>Streak length = 5 (meets minimum requirement)</li>\n\t\t<li>The action changes on 2024-01-06, ending the streak</li>\n\t</ul>\n\t</li>\n\t<li><strong>User 2</strong>:\n\t<ul>\n\t\t<li>Performed <code>click</code> for only 4 consecutive days</li>\n\t\t<li>Does not meet the minimum streak length of 5</li>\n\t\t<li>Excluded from the result</li>\n\t</ul>\n\t</li>\n\t<li><strong>User 3</strong>:\n\t<ul>\n\t\t<li>Performed <code>view</code> for 7 consecutive days</li>\n\t\t<li>This is the longest valid sequence for this user</li>\n\t\t<li>Included in the result</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p>The Results table is ordered by streak_length in descending order, then by user_id in ascending order</p>\n</div>\n",
  "difficulty": "Hard",
  "codeSnippets": [
    {
      "lang": "MySQL",
      "code": "# Write your MySQL query statement below\n"
    },
    {
      "lang": "MS SQL Server",
      "code": "/* Write your T-SQL query statement below */\n"
    },
    {
      "lang": "PostgreSQL",
      "code": "-- Write your PostgreSQL query statement below\n"
    },
    {
      "lang": "Oracle",
      "code": "/* Write your PL/SQL query statement below */\n"
    },
    {
      "lang": "Pandas",
      "code": "import pandas as pd\n\ndef find_behaviorally_stable_users(activity: pd.DataFrame) -> pd.DataFrame:\n    "
    }
  ],
  "stats": "{\"totalAccepted\": \"945\", \"totalSubmission\": \"1.5K\", \"totalAcceptedRaw\": 945, \"totalSubmissionRaw\": 1489, \"acRate\": \"63.5%\"}",
  "metaData": "{\"mysql\": [\"CREATE TABLE if not exists activity (\\n    user_id INT,\\n    action_date DATE,\\n    action VARCHAR(255)\\n)\"], \"mssql\": [\"CREATE TABLE activity (\\n    user_id INT,\\n    action_date DATE,\\n    action VARCHAR(255)\\n)\"], \"oraclesql\": [\"CREATE TABLE activity (\\n    user_id NUMBER,\\n    action_date DATE,\\n    action VARCHAR2(255)\\n)\", \"ALTER SESSION SET nls_date_format='YYYY-MM-DD'\"], \"database\": true, \"name\": \"find_behaviorally_stable_users\", \"postgresql\": [\"CREATE TABLE activity (\\n    user_id INT,\\n    action_date DATE,\\n    action VARCHAR(255)\\n)\"], \"pythondata\": [\"activity = pd.DataFrame({\\n    \\\"user_id\\\": pd.Series(dtype=\\\"int\\\"),\\n    \\\"action_date\\\": pd.Series(dtype=\\\"datetime64[ns]\\\"),\\n    \\\"action\\\": pd.Series(dtype=\\\"string\\\")\\n})\"], \"database_schema\": {\"activity\": {\"user_id\": \"INT\", \"action_date\": \"DATE\", \"action\": \"VARCHAR(255)\"}}}",
  "sampleTestCase": "{\"headers\":{\"activity\":[\"user_id\",\"action_date\",\"action\"]},\"rows\":{\"activity\":[[1,\"2024-01-01\",\"login\"],[1,\"2024-01-02\",\"login\"],[1,\"2024-01-03\",\"login\"],[1,\"2024-01-04\",\"login\"],[1,\"2024-01-05\",\"login\"],[1,\"2024-01-06\",\"logout\"],[2,\"2024-01-01\",\"click\"],[2,\"2024-01-02\",\"click\"],[2,\"2024-01-03\",\"click\"],[2,\"2024-01-04\",\"click\"],[3,\"2024-01-01\",\"view\"],[3,\"2024-01-02\",\"view\"],[3,\"2024-01-03\",\"view\"],[3,\"2024-01-04\",\"view\"],[3,\"2024-01-05\",\"view\"],[3,\"2024-01-06\",\"view\"],[3,\"2024-01-07\",\"view\"]]}}"
}