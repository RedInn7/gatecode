{
  "questionId": "3473",
  "questionFrontendId": "3166",
  "title": "Calculate Parking Fees and Duration",
  "titleSlug": "calculate-parking-fees-and-duration",
  "content": "<p>Table: <code>ParkingTransactions</code></p>\n\n<pre>\n+--------------+-----------+\n| Column Name  | Type      |\n+--------------+-----------+\n| lot_id       | int       |\n| car_id       | int       |\n| entry_time   | datetime  |\n| exit_time    | datetime  |\n| fee_paid     | decimal   |\n+--------------+-----------+\n(lot_id, car_id, entry_time) is the primary key (combination of columns with unique values) for this table.\nEach row of this table contains the ID of the parking lot, the ID of the car, the entry and exit times, and the fee paid for the parking duration.\n</pre>\n\n<p>Write a solution to find the <strong>total parking fee</strong> paid by each car <strong>across all parking lots</strong>, and the <strong>average hourly fee</strong> (rounded to <code>2</code> decimal places) paid by <strong>each</strong> car. Also, find the <strong>parking lot</strong> where each car spent the <strong>most total time</strong>.</p>\n\n<p>Return <em>the result table ordered by </em><code>car_id</code><em><b> </b>in<b> ascending </b></em><em> order.</em></p>\n\n<p><strong>Note:</strong> Test cases are generated in such a way that an individual car cannot be in multiple parking lots at the same time.</p>\n\n<p>The result format is in the following example.</p>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example:</strong></p>\n\n<div class=\"example-block\">\n<p><strong>Input:</strong></p>\n\n<p>ParkingTransactions table:</p>\n\n<pre class=\"example-io\">\n+--------+--------+---------------------+---------------------+----------+\n| lot_id | car_id | entry_time          | exit_time           | fee_paid |\n+--------+--------+---------------------+---------------------+----------+\n| 1      | 1001   | 2023-06-01 08:00:00 | 2023-06-01 10:30:00 | 5.00     |\n| 1      | 1001   | 2023-06-02 11:00:00 | 2023-06-02 12:45:00 | 3.00     |\n| 2      | 1001   | 2023-06-01 10:45:00 | 2023-06-01 12:00:00 | 6.00     |\n| 2      | 1002   | 2023-06-01 09:00:00 | 2023-06-01 11:30:00 | 4.00     |\n| 3      | 1001   | 2023-06-03 07:00:00 | 2023-06-03 09:00:00 | 4.00     |\n| 3      | 1002   | 2023-06-02 12:00:00 | 2023-06-02 14:00:00 | 2.00     |\n+--------+--------+---------------------+---------------------+----------+\n</pre>\n\n<p><strong>Output:</strong></p>\n\n<pre class=\"example-io\">\n+--------+----------------+----------------+---------------+\n| car_id | total_fee_paid | avg_hourly_fee | most_time_lot |\n+--------+----------------+----------------+---------------+\n| 1001   | 18.00          | 2.40           | 1             |\n| 1002   | 6.00           | 1.33           | 2             |\n+--------+----------------+----------------+---------------+\n</pre>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li>For car ID 1001:\n\t<ul>\n\t\t<li>From 2023-06-01 08:00:00 to 2023-06-01 10:30:00 in lot 1: 2.5 hours, fee 5.00</li>\n\t\t<li>From 2023-06-02 11:00:00 to 2023-06-02 12:45:00 in lot 1: 1.75 hours, fee 3.00</li>\n\t\t<li>From 2023-06-01 10:45:00 to 2023-06-01 12:00:00 in lot 2: 1.25 hours, fee 6.00</li>\n\t\t<li>From 2023-06-03 07:00:00 to 2023-06-03 09:00:00 in lot 3: 2 hours, fee 4.00</li>\n\t</ul>\n\tTotal fee paid: 18.00, total hours: 7.5, average hourly fee: 2.40, most time spent in lot 1: 4.25 hours.</li>\n\t<li>For car ID 1002:\n\t<ul>\n\t\t<li>From 2023-06-01 09:00:00 to 2023-06-01 11:30:00 in lot 2: 2.5 hours, fee 4.00</li>\n\t\t<li>From 2023-06-02 12:00:00 to 2023-06-02 14:00:00 in lot 3: 2 hours, fee 2.00</li>\n\t</ul>\n\tTotal fee paid: 6.00, total hours: 4.5, average hourly fee: 1.33, most time spent in lot 2: 2.5 hours.</li>\n</ul>\n\n<p><b>Note:</b> Output table is ordered by car_id in ascending order.</p>\n</div>\n",
  "difficulty": "Medium",
  "codeSnippets": [
    {
      "lang": "MySQL",
      "code": "# Write your MySQL query statement below\n"
    },
    {
      "lang": "MS SQL Server",
      "code": "/* Write your T-SQL query statement below */\n"
    },
    {
      "lang": "PostgreSQL",
      "code": "-- Write your PostgreSQL query statement below\n"
    },
    {
      "lang": "Oracle",
      "code": "/* Write your PL/SQL query statement below */\n"
    },
    {
      "lang": "Pandas",
      "code": "import pandas as pd\n\ndef calculate_fees_and_duration(parking_transactions: pd.DataFrame) -> pd.DataFrame:\n    "
    }
  ],
  "stats": "{\"totalAccepted\": \"2.6K\", \"totalSubmission\": \"4.8K\", \"totalAcceptedRaw\": 2556, \"totalSubmissionRaw\": 4847, \"acRate\": \"52.7%\"}",
  "metaData": "{\"mysql\": [\"CREATE TABLE If not exists ParkingTransactions (\\n    lot_id INT,\\n    car_id INT,\\n    entry_time DATETIME,\\n    exit_time DATETIME,\\n    fee_paid DECIMAL(10, 2)\\n)\\n\"], \"mssql\": [\"CREATE TABLE ParkingTransactions (\\n    lot_id INT,\\n    car_id INT,\\n    entry_time DATETIME,\\n    exit_time DATETIME,\\n    fee_paid DECIMAL(10, 2)\\n);\\n\"], \"oraclesql\": [\"CREATE TABLE ParkingTransactions (\\n    lot_id NUMBER,\\n    car_id NUMBER,\\n    entry_time DATE,\\n    exit_time DATE,\\n    fee_paid NUMBER(10, 2)\\n)\\n\", \"ALTER SESSION SET nls_date_format='YYYY-MM-DD HH24:MI:SS'\"], \"database\": true, \"name\": \"calculate_fees_and_duration\", \"postgresql\": [\"CREATE TABLE IF NOT EXISTS ParkingTransactions (\\n    lot_id INTEGER,\\n    car_id INTEGER,\\n    entry_time TIMESTAMP,\\n    exit_time TIMESTAMP,\\n    fee_paid NUMERIC(10, 2)\\n);\"], \"pythondata\": [\"ParkingTransactions = pd.DataFrame([], columns=['lot_id', 'car_id', 'entry_time', 'exit_time', 'fee_paid']).astype({\\n    'lot_id': 'Int64',\\n    'car_id': 'Int64',\\n    'entry_time': 'datetime64[ns]',\\n    'exit_time': 'datetime64[ns]',\\n    'fee_paid': 'float64'\\n})\"], \"database_schema\": {\"ParkingTransactions\": {\"lot_id\": \"INT\", \"car_id\": \"INT\", \"entry_time\": \"DATETIME\", \"exit_time\": \"DATETIME\", \"fee_paid\": \"DECIMAL(10, 2)\"}}}",
  "sampleTestCase": "{\"headers\":{\"ParkingTransactions\":[\"lot_id\",\"car_id\",\"entry_time\",\"exit_time\",\"fee_paid\"]},\"rows\":{\"ParkingTransactions\":[[1,1001,\"2023-06-01 08:00:00\",\"2023-06-01 10:30:00\",5.00],[1,1001,\"2023-06-02 11:00:00\",\"2023-06-02 12:45:00\",3.00],[2,1001,\"2023-06-01 10:45:00\",\"2023-06-01 12:00:00\",6.00],[2,1002,\"2023-06-01 09:00:00\",\"2023-06-01 11:30:00\",4.00],[3,1001,\"2023-06-03 07:00:00\",\"2023-06-03 09:00:00\",4.00],[3,1002,\"2023-06-02 12:00:00\",\"2023-06-02 14:00:00\",2.00]]}}"
}